<div class="profile-container" 
     [style.border-color]="personalColor()"
     [style.box-shadow]="'0 4px 15px ' + personalColor() + '40'">
  
  <div *ngIf="errorMessage()" class="error-message">
    {{ errorMessage() }}
  </div>

  <div *ngIf="!errorMessage()">
    
    <div class="profile-avatar">
      <img [src]="avatarUrl() || '/Portrait_Placeholder.png'" alt="Profilbild">
    </div>

    <h2>Profil von {{ username() }}</h2>

    <div *ngIf="owner()" class="owner-controls">
      <h3>Dein Profil bearbeiten</h3>
      
      <div class="form-group">
        <label for="avatar-upload">Profilbild ändern (max. 5MB):</label>
        <input id="avatar-upload" type="file" accept="image/*" (change)="onFileSelected($event)">
      </div>

      <div class="form-group">
        <label for="color-picker">Persönliche Farbe:</label>
        <input id="color-picker" type="color" [value]="personalColor()" (change)="onColorChange($event)">
      </div>

      <div *ngIf="uploadMessage()" class="upload-message">
        {{ uploadMessage() }}
      </div>
      
      <hr class="owner-hr">

      <h4>Kniffel-Würfel anpassen</h4>

      <div class="form-group">
        <label for="dice-theme">Design-Preset:</label>
        <select id="dice-theme" (change)="onThemeChange($event)">
          <option value="custom" [selected]="!diceConfig()?.theme_colorset">
            -- Benutzerdefiniert --
          </option>
          <option *ngFor="let key of colorsetKeys" [value]="key" [selected]="key === diceConfig()?.theme_colorset">
            {{ colorsets[key].name }} ({{ colorsets[key].category }})
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="dice-texture">Textur:</label>
        <select id="dice-texture" 
                [ngModel]="diceConfig()?.theme_texture || 'none'" 
                (ngModelChange)="onTextureChange($event)">
          <option *ngFor="let key of textureKeys" [value]="key">
            {{ texturelist[key].name }}
          </option>
          <option value="none">Keine Textur</option>
        </select>
      </div>

      <div class="form-group">
        <label for="dice-color-bg">Eigene Hintergrundfarbe:</label>
        <input id="dice-color-bg" 
              type="color" 
              [value]="getCustomBgColor()" 
              (change)="onCustomColorChange($event)">
        <small>(Setzt Preset auf "Benutzerdefiniert")</small>
      </div>

      <button (click)="saveDiceConfig()" class="save-dice-btn">Würfel-Design speichern</button>

      <div *ngIf="uploadMessage()" class="upload-message">
        {{ uploadMessage() }}
      </div>

      <hr class="owner-hr">

      <a (click)="logout()" href="#" class="logout-button">Ausloggen</a>
    </div>

    <hr>

    <div class="history-section">
      <h3>Olympiade-Verlauf</h3>
      <ul *ngIf="olympiadeHistory().length > 0; else noOlyHistory">
        <li *ngFor="let game of olympiadeHistory()">
          Olympiade #{{ game.olympiade_id }}: {{ game.final_score }} Punkte
        </li>
      </ul>
      <ng-template #noOlyHistory>
        <p>{{ username() }} hat noch an keiner Olympiade teilgenommen.</p>
      </ng-template>
    </div>

    <div class="history-section">
      <h3>Kniffel-Verlauf</h3>
      <ul *ngIf="kniffelHistory().length > 0; else noKniffelHistory">
        <li *ngFor="let game of kniffelHistory()">
          Spiel #{{ game.game_id }}: {{ game.grand_total }} Punkte
        </li>
      </ul>
      <ng-template #noKniffelHistory>
        <p>{{ username() }} hat noch kein Kniffel-Spiel beendet.</p>
      </ng-template>
    </div>

  </div>
</div>